<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Estoque</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        html, body { height:100%; margin:0; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; display:flex; flex-direction:column; background:#f5f7fa; }
        header { display:flex; flex-direction:column; align-items:center; padding:20px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.05);}
        .nav-links { display:flex; justify-content:center; gap:20px; font-weight:600; }
        .nav-links a { text-decoration:none; color:#4f83ff; padding:8px 16px; border-radius:8px; transition: all 0.3s ease; }
        .nav-links a:hover { background:#4f83ff; color:#fff; transform:translateY(-2px); box-shadow:0 4px 8px rgba(0,0,0,0.2);}
        main { flex:1; padding:20px; max-width:900px; margin:auto; width:100%; }
        .container { background:#fff; padding:30px; border-radius:12px; box-shadow:0 4px 10px rgba(0,0,0,0.1);}
        h1, h2 { color:#2c3e50; margin-bottom:20px; text-align:center; }
        .form-group { display:flex; flex-direction:column; margin-bottom:15px; }
        .form-group label { margin-bottom:5px; font-weight:600; }
        .form-group input, .form-group select { padding:10px; border-radius:6px; border:1px solid #ccc; font-size:16px; width:100%; }
        .buttons { display:flex; gap:10px; flex-wrap:wrap; margin-bottom:20px; justify-content:center; }
        .buttons button { padding:10px 20px; border:none; border-radius:6px; color:#fff; font-weight:bold; cursor:pointer; transition:all 0.3s ease; }
        .buttons button:hover { opacity:0.9; }
        .btn-salvar { background:#27ae60; }
        .btn-atualizar { background:#2980b9; }
        .btn-deletar { background:#c0392b; }
        .btn-consultar { background:#7f8c8d; }
        .btn-limpar { background:#34495e; }
        .btn-csv { background:#16a085; }
        .btn-pdf { background:#e67e22; }
        .produto-lista { display:grid; grid-template-columns:repeat(auto-fill, minmax(250px,1fr)); gap:15px; }
        .produto-card { background:#ecf0f1; border-radius:10px; padding:15px; box-shadow:0 2px 6px rgba(0,0,0,0.1); display:flex; flex-direction:column; gap:8px; }
        .produto-card span { font-weight:500; }
        .status { padding:4px 8px; border-radius:6px; font-size:14px; color:#fff; width:fit-content; text-transform:capitalize; }
        .status.Disponível { background:#27ae60; }
        .status.Indisponível { background:#c0392b; }
        .status.EmPromoção { background:#f39c12; }
        .status.Esgotado { background:#7f8c8d; }
        .status.EmReposição { background:#2980b9; }
        #total-produtos { margin-top:15px; font-weight:bold; text-align:right; }
        footer { text-align:center; padding:15px 0; background:#f1f3f6; border-top:1px solid #ddd; color:#555; font-size:14px; }

        /* Área de mensagens */
        #mensagens {
            margin-bottom: 20px;
        }
        .msg {
            padding: 10px 15px;
            border-radius: 6px;
            margin-bottom: 10px;
            font-weight: 500;
            text-align: center;
        }
        .msg.sucesso { background: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .msg.erro { background: #f8d7da; color: #721c24; border: 1px solid #f5c6cb; }
        .msg.info { background: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>
<header>
    <nav class="nav-links">
        <a href="Dashboard-relatorios-estoque.html">Dashboard</a>
        <a href="index.html">Movimentações</a>
        <a href="client-web-crud.html">Gerenciar Produtos</a>
        <a href="listagem.html">Listagem Simples</a>
    </nav>
</header>

<main>
    <div class="container">
        <h1>Sistema de Controle de Estoque</h1>

        <!-- Área para mensagens -->
        <div id="mensagens"></div>

        <div class="form-group">
            <label for="id">ID:</label>
            <input type="text" id="id" placeholder="Informe o ID (para atualizar/deletar)">
        </div>
        <div class="form-group">
            <label for="tipo">Tipo:</label>
            <input type="text" id="tipo" placeholder="Ex: Teclado, Mouse, Headset">
        </div>
        <div class="form-group">
            <label for="nome">Nome:</label>
            <input type="text" id="nome" placeholder="Nome do produto">
        </div>
        <div class="form-group">
            <label for="preco">Preço:</label>
            <input type="text" id="preco" placeholder="Preço do produto">
        </div>
        <div class="form-group">
            <label for="quantidade">Quantidade:</label>
            <input type="text" id="quantidade" placeholder="Quantidade em estoque">
        </div>
        <div class="form-group">
            <label for="status">Status:</label>
            <select id="status">
                <option value="">Selecione...</option>
                <option value="Disponível">Disponível</option>
                <option value="Indisponível">Indisponível</option>
                <option value="Esgotado">Esgotado</option>
                <option value="Em Reposição">Em Reposição</option>
                <option value="Em Promoção">Em Promoção</option>
            </select>
        </div>

        <div class="buttons">
            <button class="btn-salvar" onclick="salvar()">Salvar</button>
            <button class="btn-atualizar" onclick="atualizar()">Atualizar</button>
            <button class="btn-deletar" onclick="deletar()">Deletar</button>
            <button class="btn-consultar" onclick="carregarCampos()">Consultar</button>
            <button class="btn-limpar" onclick="limparCampos()">Limpar Campos</button>
            <button class="btn-csv" onclick="exportarCSV()">Exportar CSV</button>
            <button class="btn-pdf" onclick="exportarPDF()">Exportar PDF</button>
        </div>

        <h2>Lista de Produtos</h2>
        <div id="lista-produtos" class="produto-lista"></div>
        <p id="total-produtos"></p>
    </div>
</main>

<footer>
    © 2025 Sistema de Controle de Estoque • Desenvolvido por Gabriel Sbruzzi
</footer>

<script>
    const BASE_URL = 'http://localhost:8080/produtos';

    function mostrarMensagem(texto, tipo="info") {
        const mensagens = document.getElementById('mensagens');
        const div = document.createElement('div');
        div.className = `msg ${tipo}`;
        div.textContent = texto;
        mensagens.appendChild(div);
        setTimeout(() => div.remove(), 4000); // remove após 4s
    }

    function getProdutoFromForm() {
        const nome = document.getElementById('nome').value;
        const tipo = document.getElementById('tipo').value;
        const preco = parseFloat(document.getElementById('preco').value);
        const quantidade = parseInt(document.getElementById('quantidade').value);
        const status = document.getElementById('status').value;
        return { nome, tipo, preco, quantidade, status };
    }

    async function listarTodos() {
        try {
            const response = await fetch(BASE_URL);
            if (!response.ok) throw new Error("Erro ao listar produtos");
            const produtos = await response.json();
            const lista = document.getElementById('lista-produtos');
            const total = document.getElementById('total-produtos');
            lista.innerHTML = '';
            produtos.forEach(produto => {
                const card = document.createElement('div');
                card.className = 'produto-card';
                const tipo = produto.tipo || 'Não informado';
                const status = produto.status || 'Indisponível';
                const statusClass = status.replace(/\s+/g,'');
                card.innerHTML = `
                    <span><strong>ID:</strong> ${produto.id}</span>
                    <span><strong>Tipo:</strong> ${tipo}</span>
                    <span><strong>Nome:</strong> ${produto.nome}</span>
                    <span><strong>Preço:</strong> R$ ${produto.preco.toFixed(2)}</span>
                    <span><strong>Quantidade:</strong> ${produto.quantidade}</span>
                    <span class="status ${statusClass}">${status}</span>
                `;
                lista.appendChild(card);
            });
            total.textContent = `Total de produtos: ${produtos.length}`;
        } catch(e) { console.error(e); mostrarMensagem("Falha ao carregar lista de produtos!", "erro"); }
    }

    async function salvar() {
        const produto = getProdutoFromForm();
        try {
            const response = await fetch(BASE_URL, {
                method:'POST',
                headers:{ 'Content-Type':'application/json' },
                body:JSON.stringify(produto)
            });
            if(!response.ok) throw new Error("Erro ao salvar produto");
            listarTodos();
            mostrarMensagem("Produto salvo com sucesso!", "sucesso");
        } catch(e) { console.error(e); mostrarMensagem("Falha ao salvar produto!", "erro"); }
    }

    async function atualizar() {
        const produto = getProdutoFromForm();
        const id = document.getElementById('id').value;
        if(!id){ mostrarMensagem("Informe o ID para atualizar!", "info"); return; }
        try {
            const response = await fetch(`${BASE_URL}/${id}`, {
                method:'PUT',
                headers:{ 'Content-Type':'application/json' },
                body:JSON.stringify(produto)
            });
            if(!response.ok) throw new Error("Erro ao atualizar produto");
            listarTodos();
            mostrarMensagem("Produto atualizado com sucesso!", "sucesso");
        } catch(e){ console.error(e); mostrarMensagem("Falha ao atualizar produto!", "erro"); }
    }

    async function deletar() {
        const id = document.getElementById('id').value;
        if(!id){ mostrarMensagem("Informe o ID para deletar!", "info"); return; }
        try {
            const response = await fetch(`${BASE_URL}/${id}`, { method:'DELETE' });
            if(!response.ok) throw new Error("Erro ao deletar produto");
            listarTodos();
            mostrarMensagem("Produto deletado com sucesso!", "sucesso");
        } catch(e){ console.error(e); mostrarMensagem("Falha ao deletar produto!", "erro"); }
    }

    async function carregarCampos() {
        const id = document.getElementById('id').value;
        if(!id){ mostrarMensagem("Informe o ID para consultar!", "info"); return; }
        try {
            const response = await fetch(`${BASE_URL}/${id}`);
            if(!response.ok) throw new Error("Produto não encontrado");
            const produto = await response.json();
            document.getElementById('nome').value = produto.nome;
            document.getElementById('tipo').value = produto.tipo;
            document.getElementById('preco').value = produto.preco;
            document.getElementById('quantidade').value = produto.quantidade;
            document.getElementById('status').value = produto.status;
            mostrarMensagem("Produto carregado!", "sucesso");
        } catch(e){ console.error(e); mostrarMensagem("Falha ao consultar produto!", "erro"); }
    }

    function limparCampos() {
        document.getElementById('id').value = '';
        document.getElementById('nome').value = '';
        document.getElementById('tipo').value = '';
        document.getElementById('preco').value = '';
        document.getElementById('quantidade').value = '';
        document.getElementById('status').value = '';
        mostrarMensagem("Campos limpos!", "info");
    }

    function exportarCSV() {
        const produtos = [];
        document.querySelectorAll('.produto-card').forEach(card => {
            produtos.push({
                id: card.querySelector('span:nth-child(1)').textContent.replace('ID: ',''),
                tipo: card.querySelector('span:nth-child(2)').textContent.replace('Tipo: ',''),
                nome: card.querySelector('span:nth-child(3)').textContent.replace('Nome: ',''),
                preco: card.querySelector('span:nth-child(4)').textContent.replace('Preço: R$ ',''),
                quantidade: card.querySelector('span:nth-child(5)').textContent.replace('Quantidade: ',''),
                status: card.querySelector('span.status').textContent
            });
        });
        let csvContent = "data:text/csv;charset=utf-8,ID,Tipo,Nome,Preço,Quantidade,Status\n";
        produtos.forEach(prod => csvContent += `${prod.id},${prod.tipo},${prod.nome},${prod.preco},${prod.quantidade},${prod.status}\n`);
        const encodedUri = encodeURI(csvContent);
        const link = document.createElement("a");
        link.setAttribute("href", encodedUri);
        link.setAttribute("download","produtos_estoque.csv");
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        mostrarMensagem("CSV exportado!", "sucesso");
    }

    function exportarPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        let y = 10;
        const pageWidth = doc.internal.pageSize.getWidth()-20;
        doc.setFontSize(14);
        doc.text("Lista de Produtos - Estoque", 10, y);
        y += 10;
        document.querySelectorAll('.produto-card').forEach(card => {
            const linha = [
                card.querySelector('span:nth-child(1)').textContent,
                card.querySelector('span:nth-child(2)').textContent,
                card.querySelector('span:nth-child(3)').textContent,
                card.querySelector('span:nth-child(4)').textContent,
                card.querySelector('span:nth-child(5)').textContent,
                card.querySelector('span.status').textContent
            ].join(' | ');
            const textLines = doc.splitTextToSize(linha,pageWidth);
            doc.setFontSize(12);
            doc.text(textLines, 10, y);
            y += textLines.length * 8;

            if (y > 280) {
                doc.addPage();
                y = 10;
            }
        });

        doc.save("produtos_estoque.pdf");
        mostrarMensagem("PDF exportado!", "sucesso");
    }

    document.addEventListener('DOMContentLoaded', listarTodos);
</script>
</body>
</html>
